generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Category {
  id    Int    @id @default(autoincrement())
  name  String @unique
  items Item[]
  sets  Set[]   // relazione inversa verso Set (necessaria per Prisma)
}

model Item {
  id           Int           @id @default(autoincrement())
  brand        String?
  model        String?
  name         String?
  typology     String?
  sku          String?       @unique
  description  String?
  imageUrl     String?
  quantity     Int           @default(0)
  categoryId   Int
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  restricted   Boolean       @default(false)
  category     Category      @relation(fields: [categoryId], references: [id])
  setItems     SetItem[]
  transactions Transaction[]
}

model Set {
  id         Int       @id @default(autoincrement())
  name       String
  imageUrl   String?
  restricted Boolean   @default(false)
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
  items      SetItem[]
  categoryId Int?
  category   Category? @relation(fields: [categoryId], references: [id])
}

model SetItem {
  setId  Int
  itemId Int
  qty    Int
  item   Item @relation(fields: [itemId], references: [id])
  set    Set  @relation(fields: [setId], references: [id])

  @@id([setId, itemId])
}

model ProductionCheckout {
  id              Int            @id @default(autoincrement())
  productionName  String
  name            String
  surname         String
  ente            String
  email           String
  telephone       String
  pickupDate      DateTime
  restitutionDate DateTime
  techPerson      String?
  type            TransType      @default(CHECKOUT)
  status          CheckoutStatus @default(OPEN)
  userId          Int?
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt
  user            User?          @relation(fields: [userId], references: [id])
  transactions    Transaction[]
}

model Transaction {
  id                   Int                 @id @default(autoincrement())
  itemId               Int
  productionCheckoutId Int?
  type                 TransType
  qty                  Int
  note                 String?
  createdAt            DateTime            @default(now())
  setId                Int?
  setName              String?
  item                 Item                @relation(fields: [itemId], references: [id])
  productionCheckout   ProductionCheckout? @relation(fields: [productionCheckoutId], references: [id])
}

model User {
  id                  Int                  @id @default(autoincrement())
  username            String               @unique
  password            String
  name                String?
  role                UserRole             @default(STANDARD)
  createdAt           DateTime             @default(now())
  updatedAt           DateTime             @updatedAt
  productionCheckouts ProductionCheckout[]
}

enum TransType {
  CHECKOUT
  CHECKIN
}

enum CheckoutStatus {
  OPEN
  CLOSED
}

enum UserRole {
  ADMIN
  TECH
  STANDARD
  OFFICE
  GUEST
}
