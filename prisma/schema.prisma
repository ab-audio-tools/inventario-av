datasource db {
  provider  = "postgresql"
  // Vercel/Neon: use DATABASE_URL and DIRECT_URL
  // Netlify compat: fall back to NETLIFY_* if provided at runtime
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

generator client {
  provider = "prisma-client-js"
}

model Category {
id Int @id @default(autoincrement())
name String @unique
items Item[]
}


model Item {
  id          Int       @id @default(autoincrement())
  // Nuovi campi
  brand       String?   // es. "RCF"
  model       String?   // es. "ART 912-A"
  name        String?   // "Nome articolo" (ora facoltativo)
  typology    String?   // "Tipologia" (es. Diffusore attivo)

  sku         String?   @unique
  description String?
  imageUrl    String?
  quantity    Int       @default(0)
  // Se true, l'articolo Ã¨ visibile solo a ADMIN/TECH
  restricted  Boolean   @default(false)

  categoryId  Int
  category    Category  @relation(fields: [categoryId], references: [id])

  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  transactions Transaction[]
}

model Set {
  id         Int        @id @default(autoincrement())
  name       String
  imageUrl   String?
  restricted Boolean    @default(false)
  items      SetItem[]
  createdAt  DateTime   @default(now())
  updatedAt  DateTime   @updatedAt
}

model SetItem {
  setId  Int
  itemId Int
  qty    Int
  set    Set   @relation(fields: [setId], references: [id])
  item   Item  @relation(fields: [itemId], references: [id])

  @@id([setId, itemId])
}



model ProductionCheckout {
id Int @id @default(autoincrement())
productionName String
name String
surname String
ente String
email String
telephone String
pickupDate DateTime
restitutionDate DateTime
techPerson String?
type TransType @default(CHECKOUT)
status CheckoutStatus @default(OPEN)
userId Int?
user User? @relation(fields: [userId], references: [id])
transactions Transaction[]
createdAt DateTime @default(now())
updatedAt DateTime @updatedAt
}

model Transaction {
id Int @id @default(autoincrement())
itemId Int
item Item @relation(fields: [itemId], references: [id])
productionCheckoutId Int?
productionCheckout ProductionCheckout? @relation(fields: [productionCheckoutId], references: [id])
type TransType
qty Int
note String?
createdAt DateTime @default(now())
}


enum TransType {
CHECKOUT
CHECKIN
}

enum CheckoutStatus {
OPEN
CLOSED
}

enum UserRole {
ADMIN
TECH
STANDARD
OFFICE
GUEST
}

model User {
id Int @id @default(autoincrement())
username String @unique
password String // hashed
name String?
role UserRole @default(STANDARD)
productionCheckouts ProductionCheckout[]
createdAt DateTime @default(now())
updatedAt DateTime @updatedAt
}